<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="apple-itunes-app" content="app-id=1461458147, app-argument=weather"/>
    <link rel="stylesheet" href="/assets/css/bootstrap-3.3.7.min.css?v=202009082"/>
    <link rel="stylesheet" href="/assets/css/style.css?v=202009082"/>
    <script src="/assets/js/jquery-1.11.0.min.js?v=202009082"></script>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
</head>
<body>

<a class="new-alart navbar-fixed-top" href="/docs/api/">这里是和风天气API S6版本，该版本将于2021年12月31日下线且不再提供技术支持，新用户现已无法使用，点击查看最新版本</a>


<div class="container">
    <div class="row" id='docs-main'>
        
            <aside class="col-sm-3 col-md-3 col-lg-3 hidden-xs">
  <nav class="navbar navbar-default nav-stacked doc-nav">

    
    

    <div class="doc-nav-group">
      <a class="doc-nav-title-link" href="/docs/start/"
        title="开始">开始</a>
      <ul class="nav collapse in ">

        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/start/
          ">快速开始</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/start/get-api-key
          ">创建应用和KEY</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/start/status-code
          ">错误状态码</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/start/language
          ">多语言</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/start/icons
          ">天气图标</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/start/location-list
          ">常见城市列表</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/start/unit
          ">单位</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/start/glossary
          ">名词解释</a>
        </li>
        

      </ul>
    </div>
    
    

    <div class="doc-nav-group">
      <a class="doc-nav-title-link" href="/docs/sdk/"
        title="SDK">SDK</a>
      <ul class="nav collapse ">

        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/sdk/
          ">概述</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/sdk/ios-sdk
          ">iOS SDK</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/sdk/ios-entity
          ">iOS 数据类属性</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/sdk/android-sdk
          ">Android SDK</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/sdk/android-entity
          ">Android数据类属性</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/sdk/release
          ">下载和更新记录</a>
        </li>
        

      </ul>
    </div>
    
    

    <div class="doc-nav-group">
      <a class="doc-nav-title-link" href="/docs/widget/"
        title="天气插件">天气插件</a>
      <ul class="nav collapse ">

        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/widget/
          ">概述</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/widget/ios-widget
          ">iOS天气插件</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/widget/android-widget
          ">Android天气插件</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/widget/mobile-page
          ">H5天气网页/频道页</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/widget/standard-widget
          ">网页标准插件</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/widget/simple-widget
          ">网页简约插件</a>
        </li>
        

      </ul>
    </div>
    
    

    <div class="doc-nav-group">
      <a class="doc-nav-title-link" href="/docs/library/"
        title="代码库">代码库</a>
      <ul class="nav collapse ">

        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/library/
          ">概述</a>
        </li>
        

      </ul>
    </div>
    
    

    <div class="doc-nav-group">
      <a class="doc-nav-title-link" href="/docs/faq/"
        title="常见问题">常见问题</a>
      <ul class="nav collapse ">

        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/faq/general
          ">一般问题</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/faq/buy
          ">商业数据和购买</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/faq/technical
          ">技术和开发</a>
        </li>
        
        
        
        

        <li >
          <a class="doc-nav-item-link" href="
          /docs/faq/user
          ">用户和账号</a>
        </li>
        

      </ul>
    </div>
    
  </nav>
</aside>

<!-- for mobile -->
<nav class="navbar navbar-default" id="header-slidebar">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
        data-target="#bs-example-navbar-collapse-1" aria-expanded="false" id="header-slidebar-btn">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">
        笔记
      </a>
    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
            aria-expanded="false">开始<span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            
            <li><a href="
              /docs/start/
              ">
                快速开始
              </a></li>
            
            
            
            <li><a href="
              /docs/start/get-api-key
              ">
                创建应用和KEY
              </a></li>
            
            
            
            <li><a href="
              /docs/start/status-code
              ">
                错误状态码
              </a></li>
            
            
            
            <li><a href="
              /docs/start/language
              ">
                多语言
              </a></li>
            
            
            
            <li><a href="
              /docs/start/icons
              ">
                天气图标
              </a></li>
            
            
            
            <li><a href="
              /docs/start/location-list
              ">
                常见城市列表
              </a></li>
            
            
            
            <li><a href="
              /docs/start/unit
              ">
                单位
              </a></li>
            
            
            
            <li><a href="
              /docs/start/glossary
              ">
                名词解释
              </a></li>
            
          </ul>
          
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
            aria-expanded="false">SDK<span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            
            <li><a href="
              /docs/sdk/
              ">
                概述
              </a></li>
            
            
            
            <li><a href="
              /docs/sdk/ios-sdk
              ">
                iOS SDK
              </a></li>
            
            
            
            <li><a href="
              /docs/sdk/ios-entity
              ">
                iOS 数据类属性
              </a></li>
            
            
            
            <li><a href="
              /docs/sdk/android-sdk
              ">
                Android SDK
              </a></li>
            
            
            
            <li><a href="
              /docs/sdk/android-entity
              ">
                Android数据类属性
              </a></li>
            
            
            
            <li><a href="
              /docs/sdk/release
              ">
                下载和更新记录
              </a></li>
            
          </ul>
          
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
            aria-expanded="false">天气插件<span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            
            <li><a href="
              /docs/widget/
              ">
                概述
              </a></li>
            
            
            
            <li><a href="
              /docs/widget/ios-widget
              ">
                iOS天气插件
              </a></li>
            
            
            
            <li><a href="
              /docs/widget/android-widget
              ">
                Android天气插件
              </a></li>
            
            
            
            <li><a href="
              /docs/widget/mobile-page
              ">
                H5天气网页/频道页
              </a></li>
            
            
            
            <li><a href="
              /docs/widget/standard-widget
              ">
                网页标准插件
              </a></li>
            
            
            
            <li><a href="
              /docs/widget/simple-widget
              ">
                网页简约插件
              </a></li>
            
          </ul>
          
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
            aria-expanded="false">代码库<span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            
            <li><a href="
              /docs/library/
              ">
                概述
              </a></li>
            
          </ul>
          
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true"
            aria-expanded="false">常见问题<span class="caret"></span></a>
          <ul class="dropdown-menu">
            
            
            
            <li><a href="
              /docs/faq/general
              ">
                一般问题
              </a></li>
            
            
            
            <li><a href="
              /docs/faq/buy
              ">
                商业数据和购买
              </a></li>
            
            
            
            <li><a href="
              /docs/faq/technical
              ">
                技术和开发
              </a></li>
            
            
            
            <li><a href="
              /docs/faq/user
              ">
                用户和账号
              </a></li>
            
          </ul>
          
        </li>
      </ul>
    </div>
  </div>
</nav>
        
        
            <section class="col-sm-9 col-md-9 col-lg-9 col-xs-12">
                
                <div class="docs-header">
                    <h1>加密签名认证</h1>
                    
                </div>
                <article class="docs-content">
                    
                    <p>为了接口调用的安全性，我们推荐你使用加密签名认证方式进行接口访问的认证，加密签名方式是一种替代单独API KEY的更安全的接口访问方式，它会对请求参数加密后得到的签名字串进行身份验证。虽然我们一直强制要求使用HTTPS加密的接口调用方式，已经足够确保你的安全性，但加密签名的方式则避免了API KEY由于各种原因泄露给第三方而导致的风险。</p>

<h2 id="在接口请求中需要传递的参数">在接口请求中需要传递的参数</h2>

<table>
  <thead>
    <tr>
      <th>参数</th>
      <th>描述</th>
      <th>选择</th>
      <th>示例值</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>username</td>
      <td>用户ID，登录<a href="https://console.heweather.com">控制台</a>可查看</td>
      <td>必选</td>
      <td>username=HE161025121212039</td>
    </tr>
    <tr>
      <td>t</td>
      <td>时间戳，秒级</td>
      <td>必选</td>
      <td>t=1477455132</td>
    </tr>
    <tr>
      <td>sign</td>
      <td>数字签名，<a href="/docs/refer/secret-authorization">签名算法</a></td>
      <td>必选</td>
      <td>sign=kNWMNt1fGAm2nIr54afBg</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>如果使用数字签名方式进行接口调用认证，则不需要再传递参数：<code class="language-plaintext highlighter-rouge">key</code> ( 此参数在签名算法中，只进行 sign 的计算，不得传递 )</p>
</blockquote>

<h3 id="示例">示例</h3>
<p>以获取实况天气为例</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://api.heweather.com/s6/weather/now?location=beijing&amp;username=HE161025121212039&amp;t=1477455132&amp;sign=kNWMNt1fGAm2nIr54afBg
</code></pre></div></div>

<h2 id="数字签名sign方式如下">数字签名（sign）方式如下：</h2>

<ol>
  <li>将请求参数格式化为“key=value”格式，如“k1=v1”、“k2=v2”、“k3=v3”；</li>
  <li>去除请求参数中值为空的参数</li>
  <li>去除请求参数中参数为<code class="language-plaintext highlighter-rouge">sign</code> 的参数 ( 签名参数不参与签名算法 )</li>
  <li>将第3步剩余的键值对以字典序升序排列，并用 &amp; 符号连接，如 a=1&amp;b=2&amp;m=3&amp;w=4</li>
  <li>将第4步得到的字符串后拼接上API密钥, 假设密钥为 abc , 则 结果为:   a=1&amp;b=2&amp;m=3&amp;w=4abc</li>
  <li>将第5步得到的字符串进行MD5加密 ( 注 ：字符集为 UTF-8 )，得到签名结果</li>
  <li>将第6步得到的签名结果 作为参数添加至请求中，参数名为 <code>sign</code>, 即 <code>sign=xxxxxxx</code></li>
</ol>

<h2 id="java签名方法">JAVA签名方法</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * 和风天气签名生成算法-JAVA版本
 * @param HashMap&lt;String,String&gt; params 请求参数集，所有参数必须已转换为字符串类型
 * @param String secret 签名密钥（用户的认证key）
 * @return 签名
 * @throws IOException
 */</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getSignature</span><span class="o">(</span><span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">params</span><span class="o">,</span> <span class="nc">String</span> <span class="n">secret</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">// 先将参数以其参数名的字典序升序进行排序</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">sortedParams</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TreeMap</span><span class="o">&lt;&gt;(</span><span class="n">params</span><span class="o">);</span>
        <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;&gt;</span> <span class="n">entrys</span> <span class="o">=</span> <span class="n">sortedParams</span><span class="o">.</span><span class="na">entrySet</span><span class="o">();</span>

        <span class="c1">// 遍历排序后的字典，将所有参数按"key=value"格式拼接在一起</span>

        <span class="nc">StringBuilder</span> <span class="n">baseString</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">param</span> <span class="o">:</span> <span class="n">entrys</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//sign参数 和 空值参数 不加入算法</span>
            <span class="k">if</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getValue</span><span class="o">()!=</span><span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="s">""</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">trim</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="s">"sign"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">trim</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="s">"key"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">trim</span><span class="o">())</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="s">""</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">trim</span><span class="o">()))</span> <span class="o">{</span>
                <span class="n">baseString</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getKey</span><span class="o">().</span><span class="na">trim</span><span class="o">()).</span><span class="na">append</span><span class="o">(</span><span class="s">"="</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">param</span><span class="o">.</span><span class="na">getValue</span><span class="o">().</span><span class="na">trim</span><span class="o">()).</span><span class="na">append</span><span class="o">(</span><span class="s">"&amp;"</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(</span><span class="n">baseString</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">)</span> <span class="o">{</span>
            <span class="n">baseString</span><span class="o">.</span><span class="na">deleteCharAt</span><span class="o">(</span><span class="n">baseString</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="n">secret</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">// 使用MD5对待签名串求签</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">MessageDigest</span> <span class="n">md5</span> <span class="o">=</span> <span class="nc">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"MD5"</span><span class="o">);</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">md5</span><span class="o">.</span><span class="na">digest</span><span class="o">(</span><span class="n">baseString</span><span class="o">.</span><span class="na">toString</span><span class="o">().</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">));</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">encodeHex</span><span class="o">(</span><span class="n">bytes</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">GeneralSecurityException</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">IOException</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">char</span><span class="o">[]</span> <span class="nf">encodeHex</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span>    <span class="n">l</span>        <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
        <span class="kt">char</span><span class="o">[]</span> <span class="n">out</span>      <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">l</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span><span class="o">];</span>
        <span class="kt">int</span>    <span class="n">i</span>        <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">char</span><span class="o">[]</span> <span class="n">toDigits</span> <span class="o">=</span> <span class="o">{</span> <span class="sc">'0'</span><span class="o">,</span> <span class="sc">'1'</span><span class="o">,</span> <span class="sc">'2'</span><span class="o">,</span> <span class="sc">'3'</span><span class="o">,</span> <span class="sc">'4'</span><span class="o">,</span> <span class="sc">'5'</span><span class="o">,</span> <span class="sc">'6'</span><span class="o">,</span> <span class="sc">'7'</span><span class="o">,</span> <span class="sc">'8'</span><span class="o">,</span> <span class="sc">'9'</span><span class="o">,</span> <span class="sc">'a'</span><span class="o">,</span> <span class="sc">'b'</span><span class="o">,</span> <span class="sc">'c'</span><span class="o">,</span> <span class="sc">'d'</span><span class="o">,</span> <span class="sc">'e'</span><span class="o">,</span> <span class="sc">'f'</span> <span class="o">};</span>
        <span class="k">for</span> <span class="o">(</span> <span class="kt">int</span> <span class="n">var5</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">l</span><span class="o">;</span> <span class="o">++</span><span class="n">i</span> <span class="o">)</span> <span class="o">{</span>
            <span class="n">out</span><span class="o">[</span><span class="n">var5</span><span class="o">++]</span> <span class="o">=</span> <span class="n">toDigits</span><span class="o">[(</span><span class="mi">240</span> <span class="o">&amp;</span> <span class="n">data</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">4</span><span class="o">];</span>
            <span class="n">out</span><span class="o">[</span><span class="n">var5</span><span class="o">++]</span> <span class="o">=</span> <span class="n">toDigits</span><span class="o">[</span><span class="mi">15</span> <span class="o">&amp;</span> <span class="n">data</span><span class="o">[</span><span class="n">i</span><span class="o">]];</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">out</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>

<h2 id="php签名方法">PHP签名方法</h2>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cd">/**
  * 和风天气签名生成算法-PHP版本
  * @param array $params API调用的请求参数集合的关联数组（全部需要传递的参数组成的数组），不包含sign参数
  * @param $secret 用户的认证 key
  * @return string 返回参数签名值
  */</span>
 <span class="k">function</span> <span class="n">getSignature</span><span class="p">(</span><span class="nv">$params</span><span class="p">,</span> <span class="nv">$secret</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$str</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>  <span class="c1">//待签名字符串</span>
    <span class="c1">//先将参数以其参数名的字典序升序进行排序</span>
    <span class="nb">array_filter</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
    <span class="nb">unset</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="s1">'sign'</span><span class="p">]);</span>
    <span class="nb">unset</span><span class="p">(</span><span class="nv">$params</span><span class="p">[</span><span class="s1">'key'</span><span class="p">]);</span>
    <span class="nb">ksort</span><span class="p">(</span><span class="nv">$params</span><span class="p">);</span>
    <span class="c1">//遍历排序后的参数数组中的每一个key/value对</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$params</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$v</span><span class="p">){</span>
        <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="nv">$k</span> <span class="mf">.</span> <span class="s1">'='</span> <span class="mf">.</span> <span class="nv">$v</span> <span class="mf">.</span> <span class="s1">'&amp;'</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nv">$str</span> <span class="o">=</span> <span class="nb">substr</span><span class="p">(</span><span class="nv">$str</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="nb">strlen</span><span class="p">(</span><span class="nv">$str</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
    <span class="c1">//将签名密钥拼接到签名字符串最后面</span>
    <span class="nv">$str</span> <span class="mf">.</span><span class="o">=</span> <span class="nv">$secret</span><span class="p">;</span>
    <span class="c1">//通过md5算法为签名字符串生成一个md5签名，该签名就是我们要追加的sign参数值</span>
    <span class="k">return</span> <span class="nb">md5</span><span class="p">(</span><span class="nv">$str</span><span class="p">);</span>
 <span class="p">}</span>
</code></pre></div></div>

<h2 id="python签名方法">Python签名方法</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">sys</span><span class="p">,</span><span class="n">urllib</span><span class="p">,</span><span class="n">urllib2</span><span class="p">,</span><span class="n">hashlib</span><span class="p">,</span><span class="n">base64</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">binascii</span>

<span class="c1"># 和风天气签名生成算法-Python版本
# params API调用的请求参数集合的关联数组（全部需要传递的参数组成的数组），不包含sign参数
# secret 用户的认证 key
# return string 返回参数签名值
</span><span class="k">def</span> <span class="nf">helloWorld</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">secret</span><span class="p">):</span>
    <span class="n">canstring</span> <span class="o">=</span> <span class="s">''</span>
    <span class="c1">#先将参数以其参数名的字典序升序进行排序
</span>    <span class="n">params</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">params</span><span class="p">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item</span><span class="p">:</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c1">#遍历排序后的参数数组中的每一个key/value对
</span>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">k</span> <span class="o">!=</span> <span class="s">'sign'</span> <span class="ow">and</span> <span class="n">k</span> <span class="o">!=</span> <span class="s">'key'</span> <span class="ow">and</span> <span class="n">v</span> <span class="o">!=</span> <span class="s">''</span><span class="p">)</span> <span class="p">:</span>
         <span class="n">canstring</span> <span class="o">+=</span>  <span class="n">k</span> <span class="o">+</span> <span class="s">'='</span> <span class="o">+</span> <span class="n">v</span> <span class="o">+</span> <span class="s">'&amp;'</span>
    <span class="n">canstring</span> <span class="o">=</span> <span class="n">canstring</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">canstring</span> <span class="o">+=</span> <span class="n">secret</span>
    <span class="k">return</span> <span class="n">hashlib</span><span class="p">.</span><span class="n">md5</span><span class="p">(</span><span class="n">canstring</span><span class="p">).</span><span class="n">hexdigest</span><span class="p">()</span>
</code></pre></div></div>

                    
                </article>
            </section>
            
    </div>
</div>
<script src="/assets/js/bootstrap-3.3.7.min.js"></script>
<script src="/assets/js/cookie.min.js?v=202009082"></script>
<!-- <script src="/assets/js/baidu-analysis.js?v=202009082"></script> -->


</body>
</html>
